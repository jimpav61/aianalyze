import { jsPDF } from "jspdf";
import { DetailedFormData } from "@/types/analysis";

interface GenerateReportParams {
  formData: DetailedFormData;
  analysis: {
    industry: string;
    department: string;
    bot_function: string;
    savings: number;
    profit_increase: number;
    explanation: string;
    marketing_strategy: string;
  };
}

export const generateAnalysisReport = ({ formData, analysis }: GenerateReportParams): jsPDF => {
  const doc = new jsPDF();
  
  doc.setFont("helvetica");
  doc.setFontSize(24);
  doc.setTextColor(246, 82, 40);
  doc.text("ChatSites AI Analysis Report", 20, 30);
  
  let yPosition = 50;

  doc.setFontSize(18);
  doc.setTextColor(0);
  doc.text("Company Information", 20, yPosition);
  yPosition += 10;
  doc.setFontSize(12);
  
  const companyInfo = [
    `Company Name: ${formData.companyName}`,
    `Industry: ${analysis.industry}`,
    `Contact Email: ${formData.email}`,
    `Contact Phone: ${formData.phoneNumber}`,
    `Employees: ${formData.employees}`,
    `Revenue: ${formData.revenue}`
  ];

  companyInfo.forEach(info => {
    doc.text(info, 20, yPosition);
    yPosition += 8;
  });
  yPosition += 10;

  if (yPosition > 250) {
    doc.addPage();
    yPosition = 30;
  }
  doc.setFontSize(18);
  doc.text("Current Operations", 20, yPosition);
  yPosition += 10;
  doc.setFontSize(12);
  
  const operations = [
    `Service Channels: ${formData.serviceChannels}`,
    `Monthly Interactions: ${formData.monthlyInteractions}`,
    `Current Tools: ${formData.currentTools}`,
    `Pain Points: ${formData.painPoints}`
  ];

  operations.forEach(op => {
    const lines = doc.splitTextToSize(op, 170);
    doc.text(lines, 20, yPosition);
    yPosition += lines.length * 8;
  });
  yPosition += 10;

  if (yPosition > 250) {
    doc.addPage();
    yPosition = 30;
  }
  doc.setFontSize(18);
  doc.text("Analysis Results", 20, yPosition);
  yPosition += 10;
  doc.setFontSize(12);

  const results = [
    `Projected Annual Savings: $${analysis.savings.toLocaleString()}`,
    `Projected Profit Increase: ${analysis.profit_increase}%`,
    `Implementation Strategy: ${analysis.explanation}`,
    `Marketing Strategy: ${analysis.marketing_strategy}`
  ];

  results.forEach(result => {
    const lines = doc.splitTextToSize(result, 170);
    doc.text(lines, 20, yPosition);
    yPosition += lines.length * 8;
  });

  const pageCount = doc.getNumberOfPages();
  for (let i = 1; i <= pageCount; i++) {
    doc.setPage(i);
    doc.setFontSize(10);
    doc.setTextColor(128);
    doc.text(
      `Generated by ChatSites AI - Page ${i} of ${pageCount}`,
      20,
      doc.internal.pageSize.height - 10
    );
  }

  return doc;
};